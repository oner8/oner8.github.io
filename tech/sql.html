<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="DAN.yu"><title>SQL æ•°æ®åº“åŸºæœ¬è¯­æ³• Â· å®‰ä¸æ˜Ÿæ²³</title><meta name="description" content="ä¸€ã€åŸºç¡€
1ã€è¯´æ˜ï¼šåˆ›å»ºæ•°æ®åº“
Create DATABASE database-name2ã€è¯´æ˜ï¼šåˆ é™¤æ•°æ®åº“
drop database dbname3ã€è¯´æ˜ï¼šå¤‡ä»½sql serverâ€” åˆ›å»º å¤‡ä»½"><meta name="keywords" content=""><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"><link rel="manifest" href="/images/site.webmanifest"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"><link rel="stylesheet" href="//cdn.bootcss.com/twitter-bootstrap/3.3.7/css/bootstrap.min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><link rel="stylesheet" href="/css/style.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><script src="/js/valine.min.js"></script><meta name="generator" content="Hexo 4.2.0"></head><body><span class="donate-address">å”¯ä¸€æŒ‡å®šé‚®ç®±ï¼ši#wrdan.com</span><div id="stage" class="container"><div class="row"><div id="side-bar" class="col-sm-3 col-xs-12 side-container invisible"><div class="vertical-text site-title"><h3 tabindex="-1" class="site-title-small"><a href="/" class="a-title">ç§¯åœŸè€Œä¸ºå±±ï¼Œç§¯æ°´è€Œä¸ºæµ·</a></h3><h1 tabindex="-1" class="site-title-large"><a href="/" class="a-title">å®‰ä¸æ˜Ÿæ²³</a></h1><!--h6(onclick="triggerSiteNav()") Trigger--></div><br class="visible-lg visible-md visible-sm"><div id="site-nav" class="site-title-links"><ul><li><a href="/">é¦–é¡µ</a></li><li><a href="/archives">å½’æ¡£</a></li><li><a href="/categories">åˆ†ç±»</a></li><li><a href="/tags">æ ‡ç­¾</a></li><li><a href="/links.html">å‹é“¾</a></li><li><a href="/about.html">å…³äº</a></li><li class="soc"><a href="https://github.com/wrdan" target="_blank" rel="noopener noreferrer"><i class="fa fa-github">&nbsp;</i></a><a href="https://twitter.com/dannyw" target="_blank" rel="noopener noreferrer"><i class="fa fa-twitter">&nbsp;</i></a><a href="https://wrdan.com/atom.xml" target="_blank" rel="noopener noreferrer"><i class="fa fa-rss">&nbsp;</i></a></li></ul><div class="visible-lg visible-md visible-sm site-nav-footer"><br class="site-nav-footer-br"><footer><p>&copy;&nbsp;2020&nbsp;<a target="_blank" href="https://wrdan.com" rel="noopener noreferrer">DAN.yu</a></p><p>Theme&nbsp;<a target="_blank" href="https://github.com/SumiMakito/hexo-theme-typography" rel="noopener noreferrer">Typography</a>&nbsp;by&nbsp;<a target="_blank" href="https://www.keep.moe" rel="noopener noreferrer">Makito</a></p><p>Proudly published with&nbsp;<a target="_blank" href="https://hexo.io" rel="noopener noreferrer">Hexo</a></p></footer></div></div></div><div id="main-container" class="col-sm-9 col-xs-12 main-container invisible"><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post-container"><p class="post-title"><a>SQL æ•°æ®åº“åŸºæœ¬è¯­æ³•</a></p><p class="post-meta"><span class="meta-item"><i class="fa fa-calendar"></i><span>&nbsp;</span><span title="æ›´æ–°æ—¶é—´" class="meta-item">2016-10-23</span></span><span class="meta-item"><i class="fa fa-keyboard-o"></i><span>&nbsp;</span><span title="å­—æ•°ç»Ÿè®¡" class="meta-item">2.2k</span></span><span class="meta-item"><i class="fa fa-hourglass-o"></i><span>&nbsp;</span><span title="é˜…è¯»æ—¶é•¿" class="meta-item">10</span></span><span class="meta-item"><i class="fa fa-folder-open-o"></i><span>&nbsp;</span><a href="/categories/tech/" title="tech" class="a-tag">tech</a><span>&nbsp;</span></span></p><p class="post-abstract"><p>ä¸€ã€åŸºç¡€</p>
<p>1ã€è¯´æ˜ï¼šåˆ›å»ºæ•°æ®åº“</p>
<pre><code>Create DATABASE database-name</code></pre><p>2ã€è¯´æ˜ï¼šåˆ é™¤æ•°æ®åº“</p>
<pre><code>drop database dbname</code></pre><p>3ã€è¯´æ˜ï¼šå¤‡ä»½sql server<br>â€” åˆ›å»º å¤‡ä»½æ•°æ®çš„ device</p>
<pre><code>USE master
EXEC sp_addumpdevice &#39;disk&#39;, &#39;testBack&#39;,

&#39;c:\mssql7backup\MyNwind_1.dat&#39;</code></pre><p>â€” å¼€å§‹ å¤‡ä»½</p>
<pre><code>BACKUP DATABASE pubs TO testBack</code></pre><p>4ã€è¯´æ˜ï¼šåˆ›å»ºæ–°è¡¨</p>
<pre><code>create table tabname(col1 type1 [not null] [primary key],col2 type2

[not null],..)</code></pre><p>æ ¹æ®å·²æœ‰çš„è¡¨åˆ›å»ºæ–°è¡¨ï¼š<br>Aï¼š<code>create table tab_new like tab_old</code> (ä½¿ç”¨æ—§è¡¨åˆ›å»ºæ–°è¡¨)<br>Bï¼š</p>
<pre><code>create table tab_new as select col1,col2â€¦ from tab_old definition
only</code></pre><p>5ã€è¯´æ˜ï¼šåˆ é™¤æ–°è¡¨</p>
<pre><code>drop table tabname</code></pre><p>6ã€è¯´æ˜ï¼šå¢åŠ ä¸€ä¸ªåˆ—</p>
<pre><code>Alter table tabname add column col type</code></pre><p>æ³¨ï¼šåˆ—å¢åŠ åå°†ä¸èƒ½åˆ é™¤ã€‚DB2ä¸­åˆ—åŠ ä¸Šåæ•°æ®ç±»å‹ä¹Ÿä¸èƒ½æ”¹å˜ï¼Œå”¯ä¸€èƒ½æ”¹å˜çš„</p>
<p>æ˜¯å¢åŠ varcharç±»å‹çš„é•¿åº¦ã€‚</p>
<p>7ã€è¯´æ˜ï¼šæ·»åŠ ä¸»é”®ï¼š <code>Alter table tabname add primary key(col)</code><br>è¯´æ˜ï¼šåˆ é™¤ä¸»é”®ï¼š <code>Alter table tabname drop primary key(col)</code></p>
<p>8ã€è¯´æ˜ï¼šåˆ›å»ºç´¢å¼•ï¼š<code>create [unique] index idxname on tabname(colâ€¦.)</code><br>åˆ é™¤ç´¢å¼•ï¼š<code>drop index idxname</code><br>æ³¨ï¼šç´¢å¼•æ˜¯ä¸å¯æ›´æ”¹çš„ï¼Œæƒ³æ›´æ”¹å¿…é¡»åˆ é™¤é‡æ–°å»ºã€‚</p>
<p>9ã€è¯´æ˜ï¼šåˆ›å»ºè§†å›¾ï¼š<code>create view viewname as select statement</code><br>åˆ é™¤è§†å›¾ï¼šdrop <code>view viewname</code></p>
<p>10ã€è¯´æ˜ï¼šå‡ ä¸ªç®€å•çš„åŸºæœ¬çš„sqlè¯­å¥<br>é€‰æ‹©ï¼š<code>select * from table1 where</code> èŒƒå›´<br>æ’å…¥ï¼š<code>insert into table1(field1,field2) values(value1,value2)</code><br>åˆ é™¤ï¼š<code>delete from table1 where</code> èŒƒå›´<br>æ›´æ–°ï¼š<code>update table1 set field1=value1 where</code> èŒƒå›´<br>æŸ¥æ‰¾ï¼š<code>select * from table1 where field1 like â€™%value1%â€™</code> â€”likeçš„è¯­</p>
<p>æ³•å¾ˆç²¾å¦™ï¼ŒæŸ¥èµ„æ–™!<br>æ’åºï¼šselect * from table1 order by field1,field2 [desc]<br>æ€»æ•°ï¼šselect count as totalcount from table1<br>æ±‚å’Œï¼šselect sum(field1) as sumvalue from table1<br>å¹³å‡ï¼šselect avg(field1) as avgvalue from table1<br>æœ€å¤§ï¼šselect max(field1) as maxvalue from table1<br>æœ€å°ï¼šselect min(field1) as minvalue from table1</p>
<p>11ã€è¯´æ˜ï¼šå‡ ä¸ªé«˜çº§æŸ¥è¯¢è¿ç®—è¯<br>Aï¼š UNION è¿ç®—ç¬¦<br>UNION è¿ç®—ç¬¦é€šè¿‡ç»„åˆå…¶ä»–ä¸¤ä¸ªç»“æœè¡¨ï¼ˆä¾‹å¦‚ TABLE1 å’Œ TABLE2ï¼‰å¹¶æ¶ˆå»è¡¨ä¸­</p>
<p>ä»»ä½•é‡å¤è¡Œè€Œæ´¾ç”Ÿå‡ºä¸€ä¸ªç»“æœè¡¨ã€‚å½“ ALL éš UNION ä¸€èµ·ä½¿ç”¨æ—¶ï¼ˆå³ UNION ALL</p>
<p>ï¼‰ï¼Œä¸æ¶ˆé™¤é‡å¤è¡Œã€‚ä¸¤ç§æƒ…å†µä¸‹ï¼Œæ´¾ç”Ÿè¡¨çš„æ¯ä¸€è¡Œä¸æ˜¯æ¥è‡ª TABLE1 å°±æ˜¯æ¥è‡ª</p>
<p>TABLE2ã€‚</p>
<p>Bï¼š EXCEPT è¿ç®—ç¬¦<br>EXCEPT è¿ç®—ç¬¦é€šè¿‡åŒ…æ‹¬æ‰€æœ‰åœ¨ TABLE1 ä¸­ä½†ä¸åœ¨ TABLE2 ä¸­çš„è¡Œå¹¶æ¶ˆé™¤æ‰€æœ‰é‡</p>
<p>å¤è¡Œè€Œæ´¾ç”Ÿå‡ºä¸€ä¸ªç»“æœè¡¨ã€‚å½“ ALL éš EXCEPT ä¸€èµ·ä½¿ç”¨æ—¶ (EXCEPT ALL)ï¼Œä¸æ¶ˆ</p>
<p>é™¤é‡å¤è¡Œã€‚</p>
<p>Cï¼š INTERSECT è¿ç®—ç¬¦<br>INTERSECT è¿ç®—ç¬¦é€šè¿‡åªåŒ…æ‹¬ TABLE1 å’Œ TABLE2 ä¸­éƒ½æœ‰çš„è¡Œå¹¶æ¶ˆé™¤æ‰€æœ‰é‡å¤è¡Œ</p>
<p>è€Œæ´¾ç”Ÿå‡ºä¸€ä¸ªç»“æœè¡¨ã€‚å½“ ALL éš INTERSECT ä¸€èµ·ä½¿ç”¨æ—¶ (INTERSECT ALL)ï¼Œä¸</p>
<p>æ¶ˆé™¤é‡å¤è¡Œã€‚<br>æ³¨ï¼šä½¿ç”¨è¿ç®—è¯çš„å‡ ä¸ªæŸ¥è¯¢ç»“æœè¡Œå¿…é¡»æ˜¯ä¸€è‡´çš„ã€‚</p>
<p>12ã€è¯´æ˜ï¼šä½¿ç”¨å¤–è¿æ¥<br>Aã€left outer joinï¼š<br>å·¦å¤–è¿æ¥ï¼ˆå·¦è¿æ¥ï¼‰ï¼šç»“æœé›†å‡ åŒ…æ‹¬è¿æ¥è¡¨çš„åŒ¹é…è¡Œï¼Œä¹ŸåŒ…æ‹¬å·¦è¿æ¥è¡¨çš„æ‰€æœ‰è¡Œ</p>
<p>ã€‚<br>SQL: select a.a, a.b, a.c, b.c, b.d, b.f from a LEFT OUT JOIN b ON a.a</p>
<p>= b.c<br>Bï¼šright outer join:<br>å³å¤–è¿æ¥(å³è¿æ¥)ï¼šç»“æœé›†æ—¢åŒ…æ‹¬è¿æ¥è¡¨çš„åŒ¹é…è¿æ¥è¡Œï¼Œä¹ŸåŒ…æ‹¬å³è¿æ¥è¡¨çš„æ‰€æœ‰</p>
<p>è¡Œã€‚<br>Cï¼šfull outer joinï¼š<br>å…¨å¤–è¿æ¥ï¼šä¸ä»…åŒ…æ‹¬ç¬¦å·è¿æ¥è¡¨çš„åŒ¹é…è¡Œï¼Œè¿˜åŒ…æ‹¬ä¸¤ä¸ªè¿æ¥è¡¨ä¸­çš„æ‰€æœ‰è®°å½•ã€‚</p>
<p>äºŒã€æå‡</p>
<p>1ã€è¯´æ˜ï¼šå¤åˆ¶è¡¨(åªå¤åˆ¶ç»“æ„,æºè¡¨åï¼ša æ–°è¡¨åï¼šb) (Accesså¯ç”¨)<br>æ³•ä¸€ï¼šselect * into b from a where 1&lt;&gt;1<br>æ³•äºŒï¼šselect top 0 * into b from a</p>
<p>2ã€è¯´æ˜ï¼šæ‹·è´è¡¨(æ‹·è´æ•°æ®,æºè¡¨åï¼ša ç›®æ ‡è¡¨åï¼šb) (Accesså¯ç”¨)<br>insert into b(a, b, c) select d,e,f from b;</p>
<p>3ã€è¯´æ˜ï¼šè·¨æ•°æ®åº“ä¹‹é—´è¡¨çš„æ‹·è´(å…·ä½“æ•°æ®ä½¿ç”¨ç»å¯¹è·¯å¾„) (Accesså¯ç”¨)<br>insert into b(a, b, c) select d,e,f from b in â€˜å…·ä½“æ•°æ®åº“â€™ where æ¡</p>
<p>ä»¶<br>ä¾‹å­ï¼š..from b in â€˜â€œ&amp;Server.MapPath(â€œ.â€)&amp;â€\data.mdbâ€ &amp;â€â€˜ where..</p>
<p>4ã€è¯´æ˜ï¼šå­æŸ¥è¯¢(è¡¨å1ï¼ša è¡¨å2ï¼šb)<br>select a,b,c from a where a IN (select d from b ) æˆ–è€…: select a,b,c</p>
<p>from a where a IN (1,2,3)</p>
<p>5ã€è¯´æ˜ï¼šæ˜¾ç¤ºæ–‡ç« ã€æäº¤äººå’Œæœ€åå›å¤æ—¶é—´<br>select a.title,a.username,b.adddate from table a,(select max(adddate)</p>
<p>adddate from table where table.title=a.title) b</p>
<p>6ã€è¯´æ˜ï¼šå¤–è¿æ¥æŸ¥è¯¢(è¡¨å1ï¼ša è¡¨å2ï¼šb)<br>select a.a, a.b, a.c, b.c, b.d, b.f from a LEFT OUT JOIN b ON a.a =</p>
<p>b.c</p>
<p>7ã€è¯´æ˜ï¼šåœ¨çº¿è§†å›¾æŸ¥è¯¢(è¡¨å1ï¼ša )<br>select * from (Select a,b,c FROM a) T where t.a &gt; 1;</p>
<p>8ã€è¯´æ˜ï¼šbetweençš„ç”¨æ³•,betweené™åˆ¶æŸ¥è¯¢æ•°æ®èŒƒå›´æ—¶åŒ…æ‹¬äº†è¾¹ç•Œå€¼,not</p>
<p>betweenä¸åŒ…æ‹¬<br>select * from table1 where time between time1 and time2<br>select a,b,c, from table1 where a not between æ•°å€¼1 and æ•°å€¼2</p>
<p>9ã€è¯´æ˜ï¼šin çš„ä½¿ç”¨æ–¹æ³•<br>select * from table1 where a [not] in (â€˜å€¼1â€™,â€™å€¼2â€™,â€™å€¼4â€™,â€™å€¼6â€™</p>
<p>)</p>
<p>10ã€è¯´æ˜ï¼šä¸¤å¼ å…³è”è¡¨ï¼Œåˆ é™¤ä¸»è¡¨ä¸­å·²ç»åœ¨å‰¯è¡¨ä¸­æ²¡æœ‰çš„ä¿¡æ¯<br>delete from table1 where not exists ( select * from table2 where</p>
<p>table1.field1=table2.field1 )</p>
<p>11ã€è¯´æ˜ï¼šå››è¡¨è”æŸ¥é—®é¢˜ï¼š<br>select * from a left inner join b on a.a=b.b right inner join c on</p>
<p>a.a=c.c inner join d on a.a=d.d where â€¦..</p>
<p>12ã€è¯´æ˜ï¼šæ—¥ç¨‹å®‰æ’æå‰äº”åˆ†é’Ÿæé†’<br>SQL: select * from æ—¥ç¨‹å®‰æ’ where datediff(â€˜minuteâ€™,få¼€å§‹æ—¶é—´,getdate</p>
<p>())&gt;5</p>
<p>13ã€è¯´æ˜ï¼šä¸€æ¡sql è¯­å¥æå®šæ•°æ®åº“åˆ†é¡µ<br>select top 10 b.* from (select top 20 ä¸»é”®å­—æ®µ,æ’åºå­—æ®µ from è¡¨å</p>
<p>order by æ’åºå­—æ®µ desc) a,è¡¨å b where b.ä¸»é”®å­—æ®µ = a.ä¸»é”®å­—æ®µ order</p>
<p>by a.æ’åºå­—æ®µ</p>
<p>14ã€è¯´æ˜ï¼šå‰10æ¡è®°å½•<br>select top 10 * form table1 where èŒƒå›´</p>
<p>15ã€è¯´æ˜ï¼šé€‰æ‹©åœ¨æ¯ä¸€ç»„bå€¼ç›¸åŒçš„æ•°æ®ä¸­å¯¹åº”çš„aæœ€å¤§çš„è®°å½•çš„æ‰€æœ‰ä¿¡æ¯(ç±»ä¼¼</p>
<p>è¿™æ ·çš„ç”¨æ³•å¯ä»¥ç”¨äºè®ºå›æ¯æœˆæ’è¡Œæ¦œ,æ¯æœˆçƒ­é”€äº§å“åˆ†æ,æŒ‰ç§‘ç›®æˆç»©æ’å,ç­‰</p>
<p>ç­‰.)<br>select a,b,c from tablename ta where a=(select max(a) from tablename</p>
<p>tb where tb.b=ta.b)</p>
<p>16ã€è¯´æ˜ï¼šåŒ…æ‹¬æ‰€æœ‰åœ¨ TableA ä¸­ä½†ä¸åœ¨ TableBå’ŒTableC ä¸­çš„è¡Œå¹¶æ¶ˆé™¤æ‰€æœ‰é‡</p>
<p>å¤è¡Œè€Œæ´¾ç”Ÿå‡ºä¸€ä¸ªç»“æœè¡¨<br>(select a from tableA ) except (select a from tableB) except (select a</p>
<p>from tableC)</p>
<p>17ã€è¯´æ˜ï¼šéšæœºå–å‡º10æ¡æ•°æ®<br>select top 10 * from tablename order by newid()</p>
<p>18ã€è¯´æ˜ï¼šéšæœºé€‰æ‹©è®°å½•<br>select newid()</p>
<p>19ã€è¯´æ˜ï¼šåˆ é™¤é‡å¤è®°å½•<br>Delete from tablename where id not in (select max(id) from tablename</p>
<p>group by col1,col2,â€¦)</p>
<p>20ã€è¯´æ˜ï¼šåˆ—å‡ºæ•°æ®åº“é‡Œæ‰€æœ‰çš„è¡¨å<br>select name from sysobjects where type=â€™Uâ€™</p>
<p>21ã€è¯´æ˜ï¼šåˆ—å‡ºè¡¨é‡Œçš„æ‰€æœ‰çš„<br>select name from syscolumns where id=object_id(â€˜TableNameâ€™)</p>
<p>22ã€è¯´æ˜ï¼šåˆ—ç¤ºtypeã€venderã€pcså­—æ®µï¼Œä»¥typeå­—æ®µæ’åˆ—ï¼Œcaseå¯ä»¥æ–¹ä¾¿åœ°å®</p>
<p>ç°å¤šé‡é€‰æ‹©ï¼Œç±»ä¼¼select ä¸­çš„caseã€‚<br>select type,sum(case vender when â€˜Aâ€™ then pcs else 0 end),sum(case</p>
<p>vender when â€˜Câ€™ then pcs else 0 end),sum(case vender when â€˜Bâ€™ then pcs</p>
<p>else 0 end) FROM tablename group by type<br>æ˜¾ç¤ºç»“æœï¼š<br>type vender pcs<br>ç”µè„‘ A 1<br>ç”µè„‘ A 1<br>å…‰ç›˜ B 2<br>å…‰ç›˜ A 2<br>æ‰‹æœº B 3<br>æ‰‹æœº C 3</p>
<p>23ã€è¯´æ˜ï¼šåˆå§‹åŒ–è¡¨table1</p>
<p>TRUNCATE TABLE table1</p>
<p>24ã€è¯´æ˜ï¼šé€‰æ‹©ä»10åˆ°15çš„è®°å½•<br>select top 5 * from (select top 15 * from table order by id asc)</p>
<p>table_åˆ«å order by id desc<br>ä¸‰ã€æŠ€å·§</p>
<p>1ã€1=1ï¼Œ1=2çš„ä½¿ç”¨ï¼Œåœ¨SQLè¯­å¥ç»„åˆæ—¶ç”¨çš„è¾ƒå¤š</p>
<p>â€œwhere 1=1â€ æ˜¯è¡¨ç¤ºé€‰æ‹©å…¨éƒ¨ â€œwhere 1=2â€å…¨éƒ¨ä¸é€‰ï¼Œ<br>å¦‚ï¼š<br>if @strWhere !=â€™â€™<br>begin<br>set @strSQL = â€˜select count(*) as Total from [â€˜ + @tblName + â€˜] where</p>
<p>â€˜ + @strWhere<br>end<br>else<br>begin<br>set @strSQL = â€˜select count(*) as Total from [â€˜ + @tblName + â€˜]â€™<br>end</p>
<p>æˆ‘ä»¬å¯ä»¥ç›´æ¥å†™æˆ<br>set @strSQL = â€˜select count(*) as Total from [â€˜ + @tblName + â€˜] where</p>
<p>1=1 å®‰å®š â€˜+ @strWhere</p>
<p>2ã€æ”¶ç¼©æ•°æ®åº“<br>â€“é‡å»ºç´¢å¼•<br>DBCC REINDEX<br>DBCC INDEXDEFRAG<br>â€“æ”¶ç¼©æ•°æ®å’Œæ—¥å¿—<br>DBCC SHRINKDB<br>DBCC SHRINKFILE</p>
<p>3ã€å‹ç¼©æ•°æ®åº“<br>dbcc shrinkdatabase(dbname)</p>
<p>4ã€è½¬ç§»æ•°æ®åº“ç»™æ–°ç”¨æˆ·ä»¥å·²å­˜åœ¨ç”¨æˆ·æƒé™<br>exec sp_change_users_login â€˜update_oneâ€™,â€™newnameâ€™,â€™oldnameâ€™<br>go</p>
<p>5ã€æ£€æŸ¥å¤‡ä»½é›†<br>RESTORE VERIFYONLY from disk=â€™E:\dvbbs.bakâ€™</p>
<p>6ã€ä¿®å¤æ•°æ®åº“<br>Alter DATABASE [dvbbs] SET SINGLE_USER<br>GO<br>DBCC CHECKDB(â€˜dvbbsâ€™,repair_allow_data_loss) WITH TABLOCK<br>GO<br>Alter DATABASE [dvbbs] SET MULTI_USER<br>GO</p>
<p>7ã€æ—¥å¿—æ¸…é™¤<br>SET NOCOUNT ON<br>DECLARE @LogicalFileName sysname,<br>@MaxMinutes INT,<br>@NewSize INT</p>
<p>USE tablename â€“ è¦æ“ä½œçš„æ•°æ®åº“å<br>Select @LogicalFileName = â€˜tablename_logâ€™, â€“ æ—¥å¿—æ–‡ä»¶å<br>@MaxMinutes = 10, â€“ Limit on time allowed to wrap log.<br>@NewSize = 1 â€“ ä½ æƒ³è®¾å®šçš„æ—¥å¿—æ–‡ä»¶çš„å¤§å°(M)</p>
<p>â€“ Setup / initialize<br>DECLARE @OriginalSize int<br>Select @OriginalSize = size<br>FROM sysfiles<br>Where name = @LogicalFileName<br>Select â€˜Original Size of â€˜ + db_name() + â€˜ LOG is â€˜ +<br>CONVERT(VARCHAR(30),@OriginalSize) + â€˜ 8K pages or â€˜ +<br>CONVERT(VARCHAR(30),(@OriginalSize*8/1024)) + â€˜MBâ€™<br>FROM sysfiles<br>Where name = @LogicalFileName<br>Create TABLE DummyTrans<br>(DummyColumn char (8000) not null)</p>
<p>DECLARE @Counter INT,<br>@StartTime DATETIME,<br>@TruncLog VARCHAR(255)<br>Select @StartTime = GETDATE(),<br>@TruncLog = â€˜BACKUP LOG â€˜ + db_name() + â€˜ WITH TRUNCATE_ONLYâ€™</p>
<p>DBCC SHRINKFILE (@LogicalFileName, @NewSize)<br>EXEC (@TruncLog)<br>â€“ Wrap the log if necessary.<br>WHILE @MaxMinutes &gt; DATEDIFF (mi, @StartTime, GETDATE()) â€“ time has</p>
<p>not expired<br>AND @OriginalSize = (Select size FROM sysfiles Where name =</p>
<p>@LogicalFileName)<br>AND (@OriginalSize * 8 /1024) &gt; @NewSize<br>BEGIN â€“ Outer loop.<br>Select @Counter = 0<br>WHILE ((@Counter &lt; @OriginalSize / 16) AND (@Counter &lt; 50000))<br>BEGIN â€“ update<br>Insert DummyTrans VALUES (â€˜Fill Logâ€™)<br>Delete DummyTrans<br>Select @Counter = @Counter + 1<br>END<br>EXEC (@TruncLog)<br>END<br>Select â€˜Final Size of â€˜ + db_name() + â€˜ LOG is â€˜ +<br>CONVERT(VARCHAR(30),size) + â€˜ 8K pages or â€˜ +<br>CONVERT(VARCHAR(30),(size*8/1024)) + â€˜MBâ€™<br>FROM sysfiles<br>Where name = @LogicalFileName<br>Drop TABLE DummyTrans<br>SET NOCOUNT OFF</p>
<p>8ã€è¯´æ˜ï¼šæ›´æ”¹æŸä¸ªè¡¨<br>exec sp_changeobjectowner â€˜tablenameâ€™,â€™dboâ€™</p>
<p>9ã€å­˜å‚¨æ›´æ”¹å…¨éƒ¨è¡¨</p>
<p>Create PROCEDURE dbo.User_ChangeObjectOwnerBatch<br>@OldOwner as NVARCHAR(128),<br>@NewOwner as NVARCHAR(128)<br>AS</p>
<p>DECLARE @Name as NVARCHAR(128)<br>DECLARE @Owner as NVARCHAR(128)<br>DECLARE @OwnerName as NVARCHAR(128)</p>
<p>DECLARE curObject CURSOR FOR<br>select â€˜Nameâ€™ = name,<br>â€˜Ownerâ€™ = user_name(uid)<br>from sysobjects<br>where user_name(uid)=@OldOwner<br>order by name</p>
<p>OPEN curObject<br>FETCH NEXT FROM curObject INTO @Name, @Owner<br>WHILE(@@FETCH_STATUS=0)<br>BEGIN<br>if @Owner=@OldOwner<br>begin<br>set @OwnerName = @OldOwner + â€˜.â€™ + rtrim(@Name)<br>exec sp_changeobjectowner @OwnerName, @NewOwner<br>end<br>â€“ select @name,@NewOwner,@OldOwner</p>
<p>FETCH NEXT FROM curObject INTO @Name, @Owner<br>END</p>
<p>close curObject<br>deallocate curObject<br>GO</p>
<p>10ã€SQL SERVERä¸­ç›´æ¥å¾ªç¯å†™å…¥æ•°æ®<br>declare @i int<br>set @i=1<br>while @i&lt;30<br>begin<br>insert into test (userid) values(@i)<br>set @i=@i+1<br>end</p>
</p></div><div class="pagination"><p class="clearfix"><span class="pre pagbuttons"><a role="navigation" href="/tech/nas_daohang.html" title="é—²æ¥æ— äº‹ï¼Œä»¿äº†ä¸€ä¸ª iCloud é£æ ¼ NAS å¯¼èˆªé¡µé¢ã€‚"><i class="fa fa-angle-double-left"></i>&nbsp;ä¸Šä¸€ç¯‡: é—²æ¥æ— äº‹ï¼Œä»¿äº†ä¸€ä¸ª iCloud é£æ ¼ NAS å¯¼èˆªé¡µé¢ã€‚</a></span><span>&nbsp;</span><span class="next pagbuttons"><a role="navigation" href="/linux/scistoide.html" title="ESXi ä¸­è½¬æ¢ç¡¬ç›˜æ¨¡å¼ SCSI ä¸º IDEã€‚">ä¸‹ä¸€ç¯‡: ESXi ä¸­è½¬æ¢ç¡¬ç›˜æ¨¡å¼ SCSI ä¸º IDEã€‚&nbsp;<i class="fa fa-angle-double-right"></i></a></span></p></div><a id="comments"></a><div id="valine-container"></div><script>(function(){
    if(typeof Valine !== 'undefined'){
        new Valine({
            el:'#valine-container',
            appId: 'SphQyGolSRFHnBWzGGz4XeLE-gzGzoHsz',
            appKey: 'gMqbeGAx90w5NF4G4R43I0UD',
            placeholder: 'å¿«æ¥è¯„è®ºå§ğŸ˜€',
            path: window.location.pathname
        })
    }
}())
</script></div></div></div><div class="visible-xs site-bottom-footer"><footer><p>&copy;&nbsp;2020&nbsp;<a target="_blank" href="https://wrdan.com" rel="noopener noreferrer">DAN.yu</a></p><p>Theme&nbsp;<a target="_blank" href="https://github.com/SumiMakito/hexo-theme-typography" rel="noopener noreferrer">Typography</a>&nbsp;by&nbsp;<a target="_blank" href="https://www.keep.moe" rel="noopener noreferrer">Makito</a></p><p>Proudly published with&nbsp;<a target="_blank" href="https://hexo.io" rel="noopener noreferrer">Hexo</a></p></footer></div></div></div></div><script src="/js/jquery-3.1.0.min.js"></script><script src="/js/bootstrap.min.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/google-analytics.js"></script><script src="/js/typography.min.js"></script></body></html>